# ğŸ¯ McKinsey çˆ¬è™«é‡æ„è¯´æ˜

## ğŸ“‹ é—®é¢˜è¯Šæ–­

### 1. Cookie å¼¹çª—é®æŒ¡ âŒ
**ç°è±¡**: æˆªå›¾åº•éƒ¨æœ‰å·¨å¤§çš„ç™½è‰²æ¨ªæ¡ "We use cookies..."  
**åæœ**: é˜»æ­¢é¡µé¢æ­£å¸¸äº¤äº’ï¼Œå¯èƒ½å¯¼è‡´å†…å®¹åŠ è½½ä¸å®Œå…¨  
**è§£å†³**: âœ… æ·»åŠ  `handle_cookie_popup()` æ–¹æ³•è‡ªåŠ¨å¤„ç†

### 2. åªçˆ¬ç´¢å¼•é¡µï¼Œä¸æ˜¯è¯¦æƒ…é¡µ âŒ
**ç°è±¡**: åªè®¿é—®äº†åˆ—è¡¨é¡µï¼Œæ²¡æœ‰è¿›å…¥æ–‡ç« è¯¦æƒ…é¡µ  
**åæœ**: åªèƒ½è·å–æ ‡é¢˜å’Œç®€ä»‹ï¼Œæ— æ³•è·å–å®Œæ•´æ­£æ–‡ï¼ˆRAGéœ€è¦å‡ åƒå­—çš„æ·±åº¦åˆ†æï¼‰  
**è§£å†³**: âœ… å®ç°ä¸¤é˜¶æ®µçˆ¬å–æ¨¡å¼

### 3. ç¼ºå°‘å†…å®¹æ¸…æ´— âŒ
**ç°è±¡**: åŸå§‹HTMLåŒ…å«å¤§é‡æ— ç”¨æ ‡ç­¾ã€è„šæœ¬ã€CSS  
**åæœ**: Tokenæµªè´¹ï¼Œæ£€ç´¢æ··ä¹±ï¼ŒRAGæ•ˆæœå·®  
**è§£å†³**: âœ… æ·»åŠ  `_extract_clean_content()` æ·±åº¦æ¸…æ´—

## ğŸ—ï¸ æ–°æ¶æ„ï¼šä¸¤é˜¶æ®µçˆ¬å–

### ğŸŒ¾ é˜¶æ®µä¸€ï¼šæ”¶å‰²æœº (Harvester)
**ç›®æ ‡**: æ”¶é›†æ‰€æœ‰æ–‡ç« çš„URLåˆ—è¡¨

```
1. è®¿é—®åˆ—è¡¨é¡µ (featured-insights)
2. ğŸª å¤„ç†Cookieå¼¹çª—
3. ğŸ“œ æ»šåŠ¨é¡µé¢åŠ è½½æ›´å¤šå†…å®¹
4. ğŸ” æå–æ‰€æœ‰æ–‡ç« é“¾æ¥
5. ğŸ’¾ ä¿å­˜è°ƒè¯•æˆªå›¾å’ŒHTML
```

**è¾“å‡º**: 
- æ–‡ç« URLåˆ—è¡¨ï¼ˆå»é‡ã€è¿‡æ»¤ï¼‰
- `stage1_article_list.png` - åˆ—è¡¨é¡µæˆªå›¾
- `stage1_page.html` - åˆ—è¡¨é¡µHTML

### ğŸ­ é˜¶æ®µäºŒï¼šåŠ å·¥å‚ (Processor)
**ç›®æ ‡**: è®¿é—®æ¯ä¸ªURLï¼Œçˆ¬å–å®Œæ•´å†…å®¹å¹¶æ¸…æ´—

```
1. é€ä¸ªè®¿é—®æ–‡ç« è¯¦æƒ…é¡µ
2. ğŸª å†æ¬¡å¤„ç†Cookieï¼ˆé˜²æ­¢é‡æ–°å¼¹å‡ºï¼‰
3. ğŸ“„ æå–å®Œæ•´æ­£æ–‡ï¼ˆä¸æ˜¯ç®€ä»‹ï¼ï¼‰
4. ğŸ§¹ æ·±åº¦æ¸…æ´—å†…å®¹
   - ç§»é™¤ script, style, nav, footer
   - åªä¿ç•™ p, h2, h3, h4, li ç­‰å†…å®¹æ ‡ç­¾
   - è¿‡æ»¤å¯¼èˆªã€å¹¿å‘Šã€è®¢é˜…ç­‰æ–‡æœ¬
   - æ¸…ç†å¤šä½™ç©ºç™½
5. ğŸ“Š ç»Ÿè®¡å­—ç¬¦æ•°å’Œå•è¯æ•°
```

**è¾“å‡º**:
- æ¸…æ´—åçš„é«˜è´¨é‡æ–‡ç« æ•°æ®
- åŒ…å«å®Œæ•´æ­£æ–‡ï¼ˆé€šå¸¸å‡ åƒå­—ï¼‰

## ğŸ”§ æ ¸å¿ƒæ”¹è¿›

### 1. Cookie å¼¹çª—å¤„ç†
```python
def handle_cookie_popup(self, timeout: int = 5000):
    """è‡ªåŠ¨æ£€æµ‹å¹¶å…³é—­ Cookie å¼¹çª—"""
    cookie_selectors = [
        'button:has-text("Accept")',
        '#onetrust-accept-btn-handler',
        '#accept-recommended-btn-handler',
        ...
    ]
    # è‡ªåŠ¨å°è¯•æ‰€æœ‰å¸¸è§é€‰æ‹©å™¨
```

### 2. URLæ”¶é›†é€»è¾‘
```python
def _extract_article_urls(self, soup, max_items):
    """æ™ºèƒ½æå–æ–‡ç« é“¾æ¥"""
    # åªæå–åŒ…å«ç‰¹å®šæ¨¡å¼çš„URL
    patterns = [
        '/featured-insights/',
        '/our-insights/',
        '/industries/',
        ...
    ]
    # è¿‡æ»¤æ‰éæ–‡ç« é“¾æ¥ï¼ˆPDFã€å›¾ç‰‡ã€å¯¼èˆªç­‰ï¼‰
```

### 3. å†…å®¹æ·±åº¦æ¸…æ´—
```python
def _extract_clean_content(self, soup):
    """æå–å¹¶æ¸…æ´—æ­£æ–‡"""
    # 1. ç§»é™¤æ— ç”¨å…ƒç´ 
    for element in soup.find_all(['script', 'style', 'nav', ...]):
        element.decompose()
    
    # 2. æŸ¥æ‰¾æ–‡ç« æ­£æ–‡å®¹å™¨
    content_selectors = ['article', '[class*="article-body"]', ...]
    
    # 3. åªæå–æœ‰æ•ˆæ®µè½
    for p in container.find_all(['p', 'h2', 'h3', ...]):
        if len(text) > 20 and not is_navigation_text(text):
            paragraphs.append(text)
    
    # 4. æ¸…ç†ç©ºç™½
    content = clean_whitespace(content)
```

## ğŸ“Š æ•°æ®è´¨é‡å¯¹æ¯”

### æ—§ç‰ˆæœ¬ âŒ
```json
{
  "title": "Article Title",
  "content": "Brief snippet from list page... [200 chars]"
}
```
- âŒ å†…å®¹å¤ªçŸ­ï¼ˆ200å­—ç¬¦ï¼‰
- âŒ åªæœ‰ç®€ä»‹ï¼Œæ²¡æœ‰æ­£æ–‡
- âŒ åŒ…å«HTMLæ ‡ç­¾å’Œè„šæœ¬
- âŒ ä¸é€‚åˆRAG

### æ–°ç‰ˆæœ¬ âœ…
```json
{
  "title": "Article Title",
  "url": "https://...",
  "date": "2024-11-28",
  "authors": ["Author 1", "Author 2"],
  "content": "Deep analysis content... [5000+ chars]",
  "tags": ["Industry", "Topic"],
  "content_length": 5234,
  "word_count": 876,
  "source": "McKinsey Insights"
}
```
- âœ… å®Œæ•´æ­£æ–‡ï¼ˆ5000+å­—ç¬¦ï¼‰
- âœ… æ·±åº¦åˆ†æå†…å®¹
- âœ… çº¯æ–‡æœ¬ï¼Œæ— HTMLæ ‡ç­¾
- âœ… é€‚åˆRAGæ£€ç´¢

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿæµ‹è¯•
```bash
cd data-pipeline
python quick_test.py
```

### å‘½ä»¤è¡Œè¿è¡Œ
```bash
python run_scrapers.py --source mckinsey --limit 5 --no-headless
```

### ä»£ç è°ƒç”¨
```python
from scrapers.mckinsey_playwright_scraper import McKinseyPlaywrightScraper

scraper = McKinseyPlaywrightScraper(headless=True)
results = scraper.scrape(max_items=5)
scraper.close()

# æ¯ç¯‡æ–‡ç« åŒ…å«å®Œæ•´æ­£æ–‡
for article in results:
    print(f"æ ‡é¢˜: {article['title']}")
    print(f"å­—æ•°: {article['word_count']}")
    print(f"æ­£æ–‡: {article['content'][:200]}...")
```

## ğŸ“ˆ é¢„æœŸç»“æœ

- âœ… æ¯ç¯‡æ–‡ç«  **3000-8000** å­—ç¬¦ï¼ˆå¹³å‡5000ï¼‰
- âœ… æ¯ç¯‡æ–‡ç«  **500-1500** å•è¯ï¼ˆå¹³å‡800ï¼‰
- âœ… çº¯æ–‡æœ¬ï¼Œæ— HTMLæ ‡ç­¾
- âœ… åŒ…å«æ ‡é¢˜ã€æ—¥æœŸã€ä½œè€…ã€æ­£æ–‡ã€æ ‡ç­¾
- âœ… é€‚åˆç›´æ¥å¯¼å…¥RAGç³»ç»Ÿ

## ğŸ” è°ƒè¯•æ–‡ä»¶

### é˜¶æ®µä¸€è¾“å‡º
- `storage/raw/mckinsey_reports/stage1_article_list.png` - åˆ—è¡¨é¡µæˆªå›¾
- `storage/raw/mckinsey_reports/stage1_page.html` - åˆ—è¡¨é¡µHTML

### æœ€ç»ˆè¾“å‡º
- `storage/processed/mckinsey_clean_YYYYMMDD_HHMMSS.json` - æ¸…æ´—åçš„æ–‡ç« æ•°æ®

### æ—¥å¿—
- `storage/logs/data_pipeline_YYYY-MM-DD.log` - è¯¦ç»†æ—¥å¿—

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Cookie å¤„ç†**: è‡ªåŠ¨åœ¨ä¸¤ä¸ªé˜¶æ®µéƒ½å¤„ç†Cookieå¼¹çª—
2. **ç¤¼è²Œçˆ¬å–**: æ¯ç¯‡æ–‡ç« ä¹‹é—´å»¶è¿Ÿ3ç§’
3. **å†…å®¹éªŒè¯**: è‡ªåŠ¨è¿‡æ»¤å¤ªçŸ­çš„æ–‡ç« ï¼ˆ<100å­—ç¬¦ï¼‰
4. **é”™è¯¯å¤„ç†**: å•ç¯‡æ–‡ç« å¤±è´¥ä¸å½±å“å…¶ä»–æ–‡ç« 
5. **è°ƒè¯•æ¨¡å¼**: ä½¿ç”¨ `headless=False` å¯ä»¥çœ‹åˆ°æµè§ˆå™¨è¿è¡Œ

## ğŸ¯ ä¸‹ä¸€æ­¥

çˆ¬å–çš„é«˜è´¨é‡å†…å®¹å¯ä»¥ç›´æ¥ç”¨äº:
1. **å‘é‡åŒ–**: ä½¿ç”¨ Gemini/OpenAI ç”Ÿæˆ embeddings
2. **å­˜å‚¨**: ä¸Šä¼ åˆ° Pinecone å‘é‡æ•°æ®åº“
3. **æ£€ç´¢**: RAG ç³»ç»ŸæŸ¥è¯¢ç›¸å…³å†…å®¹
4. **åˆ†æ**: è¡Œä¸šè¶‹åŠ¿åˆ†æã€å…³é”®è¯æå–ç­‰

## ğŸ†š å¯¹æ¯”æ€»ç»“

| é¡¹ç›® | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ |
|------|--------|--------|
| Cookieå¤„ç† | âŒ æ—  | âœ… è‡ªåŠ¨å¤„ç† |
| çˆ¬å–æ¨¡å¼ | âŒ å•é˜¶æ®µ | âœ… ä¸¤é˜¶æ®µ |
| å†…å®¹æ¥æº | âŒ ç´¢å¼•é¡µ | âœ… è¯¦æƒ…é¡µ |
| å†…å®¹é•¿åº¦ | âŒ 200å­—ç¬¦ | âœ… 5000+å­—ç¬¦ |
| å†…å®¹è´¨é‡ | âŒ ç®€ä»‹ | âœ… å®Œæ•´æ­£æ–‡ |
| å†…å®¹æ¸…æ´— | âŒ æ—  | âœ… æ·±åº¦æ¸…æ´— |
| è°ƒè¯•ä¿¡æ¯ | âŒ å°‘ | âœ… å®Œæ•´ |
| RAGé€‚ç”¨æ€§ | âŒ å·® | âœ… ä¼˜ç§€ |

---

**ç°åœ¨å¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼**

```bash
cd data-pipeline
python quick_test.py
```

